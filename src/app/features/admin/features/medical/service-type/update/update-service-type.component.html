<div class="fixed inset-0 flex items-center justify-center bg-black/80 z-50">
    <div class="bg-white rounded-xl shadow-xl w-1/2 max-h-[90vh] overflow-y-auto">
        <!-- Header -->
        <div class="bg-sky-600 text-white p-2 rounded-t-xl flex justify-between items-center sticky top-0 z-10">
            <h2 class="text-lg font-bold pl-2">
                <fa-icon [icon]="faPenToSquare"></fa-icon>&nbsp; CẬP NHẬT CHUYÊN MÔN
            </h2>
            <button (click)="closeModal()"
                class="text-white bg-transparent hover:bg-red-500 rounded-full p-1 flex items-center justify-center"
                style="width: 30px; height: 30px;">
                ✕
            </button>
        </div>

        <!-- Content -->
        <div class="p-6">
            <!-- Grid layout: Hình ảnh bên trái (3), Form bên phải (7) -->
            <div class="grid grid-cols-1 md:grid-cols-12 gap-6">

                <!-- Section Hình ảnh (Bên trái) -->
                <div class="md:col-span-4 flex flex-col">
                    <label class="block text-sm font-semibold text-sky-800 mb-3">Hình ảnh</label>

                    <!-- Preview Hình ảnh -->
                    <div class="flex justify-center mb-4 flex-1">
                        <div class="relative w-full bg-gray-100 rounded-lg border-2 border-dashed border-sky-300 flex items-center justify-center overflow-hidden"
                            style="aspect-ratio: 1;">
                            <img [src]="previewImage" alt="Preview" class="w-full h-full object-cover" />
                        </div>
                    </div>

                    <!-- Hidden File Input -->
                    <input #imageInput type="file" id="imageInput"
                        accept="image/jpeg,image/jpg,image/png,image/gif,image/webp" (change)="onImageSelected($event)"
                        class="hidden" />

                    <!-- Buttons -->
                    <div class="flex flex-col gap-2">
                        <button (click)="triggerFileInput()"
                            class="bg-sky-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-sky-700 transition duration-200 flex items-center justify-center gap-2 w-full">
                            <fa-icon [icon]="faCamera"></fa-icon>
                            {{ category.image && !selectedFile ? 'Thay đổi hình ảnh' : 'Chọn hình ảnh' }}
                        </button>

                        <button *ngIf="selectedFile" (click)="removeImage()"
                            class="bg-red-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-red-700 transition duration-200 flex items-center justify-center gap-2 w-full">
                            <fa-icon [icon]="faTrash"></fa-icon>
                            Xóa
                        </button>
                    </div>

                    <!-- Ghi chú định dạng -->
                    <div class="text-xs text-gray-600 text-center mt-3">
                        <div *ngIf="selectedFile" class="text-green-600">✓ {{ selectedFile.name }}</div>
                        <div *ngIf="!selectedFile && category.image" class="text-blue-600">Hình ảnh hiện tại</div>
                        <div *ngIf="!selectedFile && !category.image" class="text-gray-500">Hình ảnh mặc định</div>
                        <div class="text-gray-500 mt-1">Hỗ trợ: JPEG, JPG, PNG, GIF, WebP</div>
                    </div>
                </div>

                <!-- Form nhập thông tin (Bên phải) -->
                <!-- <div class="md:col-span-8 grid grid-cols-1 gap-4"> -->
                <div class="md:col-span-8 gap-4">
                    <!-- Mã chuyên môn -->
                    <div>
                        <label class="block text-sm font-semibold text-sky-800">Mã chuyên môn</label>
                        <input type="text" [(ngModel)]="category.id" name="categoryId" disabled
                            class="w-full p-2 bg-gray-50 border border-gray-200 rounded-md text-gray-700 mt-1 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>

                    <!-- Tên chuyên môn -->
                    <div>
                        <label class="block text-sm font-semibold text-sky-800 mt-2">Tên chuyên môn <span
                                class="text-red-800">(*)</span></label>
                        <input type="text" [(ngModel)]="formData.categoryName" name="categoryName"
                            class="w-full p-2 border border-sky-300 rounded-md text-gray-700 mt-1 focus:outline-none focus:ring-2 focus:ring-blue-500" />
                    </div>

                    <!-- Mô tả -->
                    <div>
                        <label class="block text-sm font-semibold text-sky-800 mt-2">Mô tả <span
                                class="text-red-800">(*)</span></label>
                        <textarea [(ngModel)]="formData.description" name="description" rows="6"
                            class="w-full p-2 border border-sky-300 rounded-md text-gray-700 mt-1 focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"></textarea>
                    </div>
                </div>

            </div>
        </div>
        <!-- Footer -->
        <div class="flex justify-end gap-4 pb-6 pr-6 border-t border-gray-200 pt-4">
            <button (click)="closeModal()" [disabled]="isUploadingImage"
                class="bg-white text-sky-600 border border-sky-600 font-semibold py-2 px-8 rounded-lg hover:bg-gray-100 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">
                Hủy &nbsp;<fa-icon [icon]="faXmark"></fa-icon>
            </button>
            <button (click)="handleSubmit()" [disabled]="isUploadingImage"
                class="bg-sky-600 text-white font-semibold py-2 px-8 rounded-lg hover:bg-blue-600 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2">
                <span *ngIf="isUploadingImage" class="inline-block animate-spin">⏳</span>
                {{ isUploadingImage ? 'Đang cập nhật...' : 'Cập nhật' }}
                <fa-icon [icon]="faPenToSquare"></fa-icon>
            </button>
        </div>
    </div>
</div>

<!-- Confirm Modal -->
<app-admin-modal-confirm *ngIf="showConfirmModal" [title]="'Xác nhận cập nhật'"
    [content]="'Bạn có chắc chắn muốn cập nhật thông tin chuyên môn này?'" (confirm)="onConfirmUpdate()"
    (cancel)="showConfirmModal = false">
</app-admin-modal-confirm>