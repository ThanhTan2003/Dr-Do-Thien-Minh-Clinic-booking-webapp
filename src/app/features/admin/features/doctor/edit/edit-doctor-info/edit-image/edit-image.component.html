<div class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
        <!-- Header -->
        <!-- <div class="flex items-center justify-between p-4 border-b border-gray-200">
            <h2 class="text-lg font-bold text-gray-800">
                C·∫≠p nh·∫≠t ·∫£nh ƒë·∫°i di·ªán
            </h2>
            <button
                (click)="close()"
                class="text-gray-600 hover:text-red-500 transition"
                style="font-size: 24px;">
                ‚úï
            </button>
        </div> -->

        <!-- Header -->
        <div class="bg-sky-600 text-white p-2 rounded-t-lg flex justify-between items-center sticky top-0 z-10">
            <h2 class="text-lg font-bold pl-2">
                <fa-icon [icon]="faPenToSquare"></fa-icon>&nbsp; C·∫¨P NH·∫¨T ·∫¢NH ƒê·∫†I DI·ªÜN
            </h2>
            <button (click)="close()"
                class="text-white bg-transparent hover:bg-red-500 rounded-full p-1 flex items-center justify-center"
                style="width: 30px; height: 30px;">
                ‚úï
            </button>
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-auto p-6 flex-col items-center justify-center">
            <!-- Upload Section -->
            <div *ngIf="!imageLoaded" class="text-center">
                <button
                    (click)="triggerFileInput()"
                    class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-3 px-8 rounded-lg transition flex items-center gap-2 mx-auto">
                    <fa-icon [icon]="faUpload"></fa-icon>
                    ChoÃ£n aÃânh t·ª´ thi√™ÃÅt biÃ£
                </button>
                <p class="text-gray-500 text-sm mt-4">H·ªó tr·ª£: JPEG, JPG, PNG, GIF, WebP</p>
            </div>

            <!-- Canvas Section -->
            <div *ngIf="imageLoaded" class="flex flex-col items-center">
                <canvas
                    #canvas
                    [width]="canvasWidth"
                    [height]="canvasHeight"
                    (mousedown)="onCanvasMouseDown($event)"
                    (mousemove)="onCanvasMouseMove($event)"
                    (mouseup)="onCanvasMouseUp()"
                    (mouseleave)="onCanvasMouseLeave()"
                    class="border-2 border-gray-300 rounded-lg cursor-move shadow-lg bg-gray-50 mb-4"
                    style="max-width: 50%; max-height: 500px;"
                ></canvas>
            </div>

            <!-- Hidden File Input -->
            <input
                #fileInput
                type="file"
                accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
                (change)="onFileSelected($event)"
                class="hidden"
            />
        </div>

        <!-- Controls -->
        <div *ngIf="imageLoaded" class="border-t border-gray-200 p-4">
            <div class="flex items-center justify-center gap-4 mb-4">
                <button
                    (click)="onZoomOut()"
                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-3 rounded transition">
                    <fa-icon [icon]="faMinus"></fa-icon>
                </button>

                <input
                    type="range"
                    [min]="baseScale"
                    [max]="maxScale"
                    step="0.05"
                    [value]="imageScale"
                    (input)="onZoomChange($event)"
                    class="w-64 h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer accent-sky-600"
                />

                <button
                    (click)="onZoomIn()"
                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-3 rounded transition">
                    <fa-icon [icon]="faPlus"></fa-icon>
                </button>

                <!-- <span class="text-gray-700 font-semibold min-w-[60px] text-center">{{ getZoomPercentage() }}%</span> -->
            </div>

            <!-- Zoom info -->
            <div class="text-xs text-gray-500 text-center mb-4">
                üí° K√©o ·∫£nh ƒë·ªÉ di chuy·ªÉn, s·ª≠ d·ª•ng slider ƒë·ªÉ ph√≥ng to/thu nh·ªè
            </div>

            <!-- Action Buttons -->
            <div class="flex justify-end gap-3">
                <button
                    (click)="close()"
                    class="bg-white hover:bg-sky-100 border border-sky-600 text-sky-600 font-bold py-2 px-6 rounded transition">
                    H·ªßy &nbsp; <fa-icon [icon]="faX"></fa-icon>
                </button>
                <button
                    (click)="triggerFileInput()"
                    class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded transition flex items-center gap-2">
                    Ch·ªçn ·∫£nh kh√°c &nbsp; <fa-icon [icon]="faUpload"></fa-icon>
                </button>
                <button
                    (click)="cropImage()"
                    class="bg-sky-600 hover:bg-sky-700 text-white font-bold py-2 px-6 rounded transition">
                    XaÃÅc nh√¢Ã£n &nbsp; <fa-icon [icon]="faCheck"></fa-icon>
                </button>
            </div>
        </div>
    </div>
</div>